# programmatically spins up an EMR cluster with 3 m3.xlarge instances
# runs hourly as a cron job - 0 * * * * sudo /home/ubuntu/auto_clusters.sh
aws emr create-cluster --no-termination-protected --applications Name=Hadoop Name=Hive Name=Pig Name=Hue Name=Spark Name=Zeppelin --ec2-attributes '{"KeyName":"data_eng_ec2","InstanceProfile":"EMR_EC2_DefaultRole","SubnetId":"subnet-06a10c2b","EmrManagedSlaveSecurityGroup":"sg-a6e2a2d9","EmrManagedMasterSecurityGroup":"sg-19e4a466"}' --release-label emr-5.5.0 --log-uri 's3n://aws-logs-965187177455-us-east-1/elasticmapreduce/' --steps '[{"Args":["spark-submit","--deploy-mode","cluster","s3://meetupevents/spark-submit/spark_submit_make_parquet.py"],"Type":"CUSTOM_JAR","ActionOnFailure":"TERMINATE_CLUSTER","Jar":"command-runner.jar","Properties":"","Name":"Spark application"}]' --instance-groups '[{"InstanceCount":1,"InstanceGroupType":"MASTER","InstanceType":"m3.xlarge","Name":"Master - 1"},{"InstanceCount":2,"InstanceGroupType":"CORE","InstanceType":"m3.xlarge","Name":"Core - 2"}]' --auto-scaling-role EMR_AutoScaling_DefaultRole --bootstrap-actions '[{"Path":"s3://meetupevents/spark-submit/bootstrap.sh","Name":"Custom action"}]' --service-role EMR_DefaultRole --enable-debugging --name 'meetup_data_auto_clusters' --scale-down-behavior TERMINATE_AT_TASK_COMPLETION --region us-east-1
